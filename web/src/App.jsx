import React,{useEffect,useState} from 'react'; import { ingestUrl, searchItems, getItem } from './api'; export default function App(){ const [url,setUrl]=useState(''); const [loading,setLoading]=useState(false); const [query,setQuery]=useState(''); const [items,setItems]=useState([]); const [selected,setSelected]=useState(null); const [error,setError]=useState(null); async function doIngest(){ setError(null); if(!url.trim())return; setLoading(true); try{ await ingestUrl(url.trim()); setUrl(''); await refresh(); }catch(e){ setError(e.message);}finally{ setLoading(false);} } async function refresh(){ try{ const rows=await searchItems(query); setItems(rows);}catch(e){ setError(e.message);} } async function openItem(id){ setSelected(null); try{ const item=await getItem(id); setSelected(item);}catch(e){ setError(e.message);} } useEffect(()=>{refresh()},[]); return (<div style={{fontFamily:'Inter, system-ui, Arial',padding:16,maxWidth:1100,margin:'0 auto'}}><h1 style={{marginBottom:8}}>Vaultly</h1><p style={{marginTop:0,color:'#555'}}>Extrae audio de enlaces, transcribe, resume y guarda con búsqueda.</p><div style={{display:'flex',gap:8,marginBottom:16}}><input value={url} onChange={e=>setUrl(e.target.value)} placeholder="Pega un enlace de YouTube, TikTok, X/Twitter, Instagram..." style={{flex:1,padding:10,borderRadius:8,border:'1px solid #ccc'}}/><button onClick={doIngest} disabled={loading} style={{padding:'10px 16px',borderRadius:8,border:'1px solid #222',background:'#111',color:'white'}}>{loading?'Procesando…':'Ingerir'}</button></div>{error&&<div style={{background:'#fee',border:'1px solid #f88',padding:10,borderRadius:8,marginBottom:12}}>{error}</div>}<div style={{display:'flex',gap:16}}><div style={{flex:1}}><div style={{marginBottom:8}}><input value={query} onChange={e=>setQuery(e.target.value)} onKeyDown={e=>e.key==='Enter'&&refresh()} placeholder="Buscar en transcripciones y resúmenes…" style={{width:'100%',padding:10,borderRadius:8,border:'1px solid #ccc'}}/></div><button onClick={refresh} style={{marginBottom:12,padding:'8px 12px',borderRadius:8,border:'1px solid #ccc'}}>Buscar</button><table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr style={{textAlign:'left',borderBottom:'1px solid #ddd'}}><th style={{padding:8}}>Título</th><th style={{padding:8}}>Plataforma</th><th style={{padding:8}}>Autor</th><th style={{padding:8}}>Fecha</th></tr></thead><tbody>{items.map(row=>(<tr key={row.id} onClick={()=>openItem(row.id)} style={{cursor:'pointer',borderBottom:'1px solid #eee'}}><td style={{padding:8}}>{row.title||'(Sin título)'}</td><td style={{padding:8}}>{row.platform||'-'}</td><td style={{padding:8}}>{row.author||'-'}</td><td style={{padding:8}}>{new Date(row.created_at).toLocaleString()}</td></tr>))}</tbody></table></div><div style={{flex:1}}>{!selected?(<div style={{color:'#666',paddingTop:40}}>Selecciona un item para ver detalles.</div>):(<div><h3 style={{marginTop:0}}>{selected.title||'(Sin título)'}</h3><div style={{fontSize:13,color:'#666',marginBottom:8}}><span style={{marginRight:10}}><b>Plataforma:</b> {selected.platform||'-'}</span><span style={{marginRight:10}}><b>Autor:</b> {selected.author||'-'}</span><span><b>Fecha:</b> {new Date(selected.created_at).toLocaleString()}</span></div><div style={{background:'#fafafa',border:'1px solid #eee',padding:12,borderRadius:8,marginBottom:12}}><h4 style={{margin:0}}>Resumen</h4><p style={{whiteSpace:'pre-wrap'}}>{selected.summary||'—'}</p></div><div style={{background:'#fafafa',border:'1px solid #eee',padding:12,borderRadius:8}}><h4 style={{margin:0}}>Puntos clave</h4><ul>{(()=>{ try{ const arr=JSON.parse(selected.key_points||'[]'); return arr.map((kp,i)=><li key={i}>{kp}</li>)}catch{return <li>—</li>} })()}</ul></div></div>)}</div></div></div>); }